---
import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer.astro";
import DownloadButtons from "../components/DownloadButtons.astro";
import { pricingOffers } from "../data/pricing";
import { pricingFaq } from "../data/faq";
import {
  getSaleTitle,
  getSaleDescription,
  getSaleAlertMessage,
} from "../utils/sale-dates";

const saleTitle = getSaleTitle();
const saleDescription = getSaleDescription();
const saleAlertMessage = getSaleAlertMessage();

const fallbackSite = new URL("https://lightlane.app");
const siteBase = Astro.site ?? fallbackSite;
const toAbsolute = (path: string) => new URL(path, siteBase).href;

const pricingKeywords = [
  "laser engraving software pricing",
  "laser cutter software cost",
  "Lightlane laser engraving subscription",
  "laser engraving software free trial",
  "Ruida laser software pricing",
  "Lightlane pricing plans",
];

// Get subscription offers for schema
const subscriptionOffers = pricingOffers.filter(o => o.type === "subscription");

const offerSchemas = pricingOffers.map((offer) => {
  const base: Record<string, unknown> = {
    "@type": "Offer",
    priceCurrency: offer.priceCurrency,
    availability: offer.availability,
    url: toAbsolute(offer.ctaPath),
    name: offer.schemaName,
    description: offer.description,
    category: "Software",
  };

  if (offer.sku) base.sku = offer.sku;
  if (typeof offer.monthlyPrice === "number") {
    base.price = offer.monthlyPrice;
    base.billingIncrement = 1;
    base.billingDuration = "P1M";
  } else {
    base.priceType = "https://schema.org/CallForPrice";
  }

  return base;
});

const fixedOffers = pricingOffers.filter(
  (offer) => typeof offer.monthlyPrice === "number"
);

const aggregateOffer =
  fixedOffers.length > 0
    ? {
        "@type": "AggregateOffer",
        priceCurrency:
          fixedOffers[0]?.priceCurrency ??
          pricingOffers[0]?.priceCurrency ??
          "USD",
        lowPrice: Math.min(...fixedOffers.map((plan) => plan.monthlyPrice as number)),
        highPrice: Math.max(...fixedOffers.map((plan) => plan.monthlyPrice as number)),
        offerCount: fixedOffers.length,
        offers: offerSchemas,
      }
    : undefined;

// pricingFaq imported from shared data/faq.ts for site-wide consistency

const pricingFaqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "@id": `${toAbsolute("/pricing")}#laser-engraving-pricing-faq`,
  mainEntity: pricingFaq.map((faq) => ({
    "@type": "Question",
    name: faq.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: faq.answer,
    },
  })),
};

const structuredData = [
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "@id": `${toAbsolute("/")}#lightlane-pricing`,
    name: "Lightlane Laser Engraving Software",
    description:
      "Pricing for Lightlane's laser engraving workflow software with flexible subscription options.",
    brand: {
      "@type": "Brand",
      name: "Lightlane",
    },
    image: toAbsolute("/NotRoundedLogo.png"),
    offers: aggregateOffer ?? offerSchemas,
    keywords: pricingKeywords.join(", "),
  },
  {
    "@context": "https://schema.org",
    "@type": "OfferCatalog",
    name: "Lightlane Pricing Plans",
    url: toAbsolute("/pricing"),
    itemListElement: offerSchemas.map((offer, index) => ({
      "@type": "ListItem",
      position: index + 1,
      item: {
        ...offer,
      },
    })),
  },
  pricingFaqSchema,
];

// Get maker and pro offers for display
const makerOffer = pricingOffers.find(o => o.tier === "maker");
const proOffer = pricingOffers.find(o => o.tier === "pro");
---

<Layout
  title="Lightlane Pricing - Start Your Free Trial"
  description="Try Lightlane free for 14 days. No credit card required. Simple monthly plans for laser engraving software."
  keywords={pricingKeywords.join(", ")}
  structuredData={structuredData}
  breadcrumbs={[
    { name: "Home", url: "/" },
    { name: "Pricing", url: "/pricing" },
  ]}
>
  <main>
    <!-- Hero Section - Trust + Value -->
    <section class="relative py-20 md:py-28 overflow-hidden">
      <div
        class="absolute inset-0 bg-[radial-gradient(circle_at_30%_40%,rgba(42,158,219,0.15),transparent_60%)]"
      >
      </div>
      <div class="container mx-auto px-4 relative">
        <div class="text-center mb-12 space-y-6 max-w-3xl mx-auto" data-animate>
          <!-- Social proof badge -->
          <div class="flex justify-center gap-3 flex-wrap">
            <div class="badge badge-soft badge-success text-xs py-3 px-4 tracking-wide flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
              14-DAY FREE TRIAL
            </div>
            <div class="badge badge-soft badge-primary text-xs py-3 px-4 tracking-wide">
              NO CREDIT CARD REQUIRED
            </div>
          </div>
          
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-ll-gradient pb-1">
            {saleTitle}
          </h1>
          <p
            class="text-lg md:text-xl text-base-content/70 max-w-2xl mx-auto"
            set:html={saleDescription}
          />
          
          <!-- Trust indicators -->
          <div class="flex flex-wrap justify-center gap-6 text-sm text-base-content/60 pt-2">
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4 text-success" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              Cancel anytime
            </span>
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4 text-success" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              Instant access
            </span>
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4 text-success" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              macOS & Windows
            </span>
          </div>
          
          {saleAlertMessage && (
            <div role="alert" class="alert alert-info justify-center">
              <span>{saleAlertMessage}</span>
            </div>
          )}
        </div>

        <!-- Pricing Cards -->
        <div
          id="plans"
          class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-5xl mx-auto"
        >
          <!-- Maker Plan -->
          {makerOffer && (
            <div
              class="plan-card group relative p-px rounded-2xl bg-gradient-to-br from-base-300/60 via-base-200 to-base-100 shadow-lg hover:shadow-primary/20 transition"
              data-animate
            >
              <div
                class="relative rounded-[inherit] bg-base-200/80 backdrop-blur-sm p-8 flex flex-col h-full border border-base-300"
              >
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-2xl font-semibold">Maker</h3>
                  <span class="badge badge-neutral badge-soft text-xs">ESSENTIAL</span>
                </div>
                <p class="text-sm text-base-content/70 mb-6 leading-relaxed">
                  Perfect for hobbyists and personal projects. Everything you need to start laser engraving.
                </p>
                
                <!-- Pricing Display -->
                <div class="mb-8">
                  <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-bold tracking-tight">${makerOffer.monthlyPrice}</span>
                    <span class="text-base-content/50">/month</span>
                  </div>
                  <p class="text-sm text-base-content/50 mt-2">
                    Billed monthly
                  </p>
                </div>
                
                <ul class="space-y-3 text-sm flex-1 mb-8">
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>GRBL & G-code export + streaming</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>Full import → preview → engrave pipeline</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>Materials presets library</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>Offline mode for air-gapped setups</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>Community support</span>
                  </li>
                  <li class="flex gap-3 items-start opacity-60">
                    <svg class="w-4 h-4 text-base-content/40 mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg>
                    <span>AI Assistant & Smart Settings</span>
                  </li>
                  <li class="flex gap-3 items-start opacity-60">
                    <svg class="w-4 h-4 text-base-content/40 mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg>
                    <span>Material Test Grid</span>
                  </li>
                  <li class="flex gap-3 items-start opacity-60">
                    <svg class="w-4 h-4 text-base-content/40 mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg>
                    <span>Ruida controller support</span>
                  </li>
                </ul>
                
                <button
                  class="btn btn-outline btn-lg w-full pricing-cta"
                  data-tier="maker"
                  data-action="subscribe"
                >
                  Start Free Trial
                </button>
                <p class="text-xs text-center text-base-content/50 mt-3">
                  14 days free, then ${makerOffer.monthlyPrice}/mo
                </p>
              </div>
            </div>
          )}

          <!-- Pro Plan (Popular) -->
          {proOffer && (
            <div
              class="plan-card group relative p-px rounded-2xl bg-gradient-to-br from-primary/40 via-primary/20 to-base-100 shadow-xl ring-2 ring-primary/50 scale-[1.02] hover:scale-[1.04] transition"
              data-animate
            >
              <!-- Popular Badge -->
              <div class="absolute -top-4 left-1/2 -translate-x-1/2 z-10">
                <div class="badge badge-primary px-4 py-3 text-sm font-semibold shadow-lg">
                  MOST POPULAR
                </div>
              </div>
              
              <div
                class="absolute -inset-px rounded-[inherit] bg-gradient-to-br from-primary/60 to-accent/40 opacity-0 group-hover:opacity-100 transition"
              >
              </div>
              <div
                class="relative rounded-[inherit] bg-base-200/90 backdrop-blur-md p-8 flex flex-col h-full border border-primary/40"
              >
                <div class="flex items-center justify-between mb-4 pt-2">
                  <h3 class="text-2xl font-semibold">Pro</h3>
                  <span class="badge badge-primary badge-soft text-xs">RECOMMENDED</span>
                </div>
                <p class="text-sm text-base-content/70 mb-6 leading-relaxed">
                  For serious makers and small businesses. Advanced controllers and priority support.
                </p>
                
                <!-- Pricing Display -->
                <div class="mb-8">
                  <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-bold tracking-tight">${proOffer.monthlyPrice}</span>
                    <span class="text-base-content/50">/month</span>
                  </div>
                  <p class="text-sm text-base-content/50 mt-2">
                    Billed monthly
                  </p>
                </div>
                
                <ul class="space-y-3 text-sm flex-1 mb-8">
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span><strong>Everything in Maker, plus:</strong></span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-primary mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span><strong>AI Assistant</strong> — image color grading & tone prep for engraving</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-primary mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span><strong>Smart Settings</strong> — AI suggests power, speed & passes for your material + goal</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-primary mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span><strong>Material Test Grid</strong> — quickly dial in settings for new materials</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>Ruida controller support <span class="badge badge-warning badge-soft text-[10px] ml-1">EARLY ALPHA</span></span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>Priority email & chat support</span>
                  </li>
                  <li class="flex gap-3 items-start">
                    <svg class="w-4 h-4 text-success mt-0.5 shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>Advanced device streaming</span>
                  </li>
                </ul>
                
                <button
                  class="btn btn-primary btn-lg w-full pricing-cta"
                  data-tier="pro"
                  data-action="subscribe"
                >
                  Start Free Trial
                </button>
                <p class="text-xs text-center text-base-content/50 mt-3">
                  14 days free, then ${proOffer.monthlyPrice}/mo
                </p>
              </div>
            </div>
          )}
        </div>

        <!-- Enterprise/Education Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto mt-8" data-animate>
          <!-- Enterprise -->
          <div class="p-6 rounded-xl bg-base-200/60 border border-base-300 flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex-1">
              <h3 class="font-semibold text-lg">Enterprise</h3>
              <p class="text-sm text-base-content/60 mt-1">
                Custom deployments with governance, automation APIs, and dedicated support.
              </p>
            </div>
            <a
              href="/contact?subject=Enterprise%20Enquiry#contact-form"
              class="btn btn-outline btn-sm shrink-0"
            >
              Contact Sales
            </a>
          </div>
          
          <!-- Education -->
          <div class="p-6 rounded-xl bg-base-200/60 border border-base-300 flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex-1">
              <h3 class="font-semibold text-lg">Education</h3>
              <p class="text-sm text-base-content/60 mt-1">
                Discounted access for schools, labs, and maker programs.
              </p>
            </div>
            <a
              href="/contact?subject=Education%20Access%20Enquiry#contact-form"
              class="btn btn-outline btn-sm shrink-0"
            >
              Get Edu Pricing
            </a>
          </div>
        </div>

        <!-- Social Proof / Risk Reversal -->
        <div class="mt-16 max-w-3xl mx-auto" data-animate>
          <div class="text-center space-y-4 p-8 rounded-2xl bg-gradient-to-br from-success/5 to-transparent border border-success/20">
            <div class="flex justify-center">
              <svg class="w-10 h-10 text-success" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"/></svg>
            </div>
            <h3 class="text-xl font-semibold">Risk-Free Guarantee</h3>
            <p class="text-base-content/70 max-w-xl mx-auto">
              Try Lightlane free for 14 days with full access to every feature. 
              No credit card required to start. Cancel anytime from your dashboard — no questions asked.
            </p>
            <div class="flex flex-wrap justify-center gap-4 pt-2">
              <span class="text-sm text-base-content/60 flex items-center gap-2">
                <svg class="w-4 h-4 text-success" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                No setup fees
              </span>
              <span class="text-sm text-base-content/60 flex items-center gap-2">
                <svg class="w-4 h-4 text-success" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                No contracts
              </span>
              <span class="text-sm text-base-content/60 flex items-center gap-2">
                <svg class="w-4 h-4 text-success" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                Cancel online anytime
              </span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Download Section - Alternative Entry Point -->
    <section id="pricing-download" class="py-16 bg-base-200/40">
      <div class="container mx-auto px-4 max-w-4xl" data-animate>
        <div class="text-center space-y-6">
          <h2 class="text-2xl md:text-3xl font-bold">
            Prefer to try before you sign up?
          </h2>
          <p class="text-base-content/70 max-w-xl mx-auto">
            Download Lightlane and explore the full app. Your 14-day trial starts when you create your free account.
          </p>
          <DownloadButtons align="center" />
          <p class="text-sm text-base-content/50">
            macOS 12+ and Windows 10+ supported. M1/M2/M3 native.
          </p>
        </div>
      </div>
    </section>

    <!-- Feature Comparison -->
    <section class="py-20">
      <div class="container mx-auto px-4 max-w-5xl" data-animate>
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-ll-gradient">
            Compare Plans
          </h2>
          <p class="mt-4 text-base-content/70">
            Both plans include the full 14-day trial. Choose what fits your workflow.
          </p>
        </div>
        
        <div class="overflow-x-auto">
          <table class="table w-full">
            <thead>
              <tr>
                <th class="text-left">Feature</th>
                <th class="text-center">Maker</th>
                <th class="text-center bg-primary/5">Pro</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>GRBL & G-code support</td>
                <td class="text-center"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
                <td class="text-center bg-primary/5"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
              </tr>
              <tr>
                <td>Import → Preview → Engrave pipeline</td>
                <td class="text-center"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
                <td class="text-center bg-primary/5"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
              </tr>
              <tr>
                <td>Materials presets</td>
                <td class="text-center"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
                <td class="text-center bg-primary/5"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
              </tr>
              <tr>
                <td>Offline mode</td>
                <td class="text-center"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
                <td class="text-center bg-primary/5"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
              </tr>
              <tr>
                <td>Ruida controller support</td>
                <td class="text-center"><svg class="w-4 h-4 text-base-content/30 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg></td>
                <td class="text-center bg-primary/5"><span class="badge badge-warning badge-soft text-xs">Alpha</span></td>
              </tr>
              <tr>
                <td>K40 / M2-Nano support</td>
                <td class="text-center"><svg class="w-4 h-4 text-base-content/30 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg></td>
                <td class="text-center bg-primary/5"><span class="badge badge-warning badge-soft text-xs">Soon</span></td>
              </tr>
              <tr>
                <td>Priority support</td>
                <td class="text-center"><svg class="w-4 h-4 text-base-content/30 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg></td>
                <td class="text-center bg-primary/5"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
              </tr>
              <tr>
                <td>Premium templates</td>
                <td class="text-center"><svg class="w-4 h-4 text-base-content/30 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg></td>
                <td class="text-center bg-primary/5"><svg class="w-4 h-4 text-success mx-auto" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></td>
              </tr>
              <tr>
                <td>Multi-seat licenses</td>
                <td class="text-center"><svg class="w-4 h-4 text-base-content/30 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 12H6"/></svg></td>
                <td class="text-center bg-primary/5"><span class="badge badge-warning badge-soft text-xs">Soon</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="flex justify-center gap-4 mt-10">
          <button class="btn btn-outline pricing-cta" data-tier="maker" data-action="subscribe">
            Try Maker Free
          </button>
          <button class="btn btn-primary pricing-cta" data-tier="pro" data-action="subscribe">
            Try Pro Free
          </button>
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="py-20 bg-base-200/40">
      <div class="container max-w-4xl mx-auto px-4" data-animate>
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-ll-gradient">
            Frequently Asked Questions
          </h2>
          <p class="mt-4 text-base-content/70">
            Everything you need to know about Lightlane pricing and trials.
          </p>
        </div>
        <div class="space-y-4">
          {
            pricingFaq.map((faq) => (
              <details class="group rounded-xl border border-base-300 bg-base-100/90 p-6 shadow-sm">
                <summary class="cursor-pointer text-lg font-semibold text-base-content transition group-open:text-primary">
                  {faq.question}
                </summary>
                <p class="mt-3 text-sm text-base-content/70 leading-relaxed">
                  {faq.answer}
                </p>
              </details>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Final CTA -->
    <section class="py-20">
      <div class="container mx-auto px-4 max-w-3xl text-center" data-animate>
        <h2 class="text-3xl md:text-4xl font-bold mb-4">
          Ready to streamline your laser workflow?
        </h2>
        <p class="text-lg text-base-content/70 mb-8 max-w-xl mx-auto">
          Join makers who switched to Lightlane for faster, more intuitive engraving. Start your free trial today.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <button class="btn btn-primary btn-lg pricing-cta" data-tier="pro" data-action="subscribe">
            Start Free Trial
          </button>
          <a href="#plans" class="btn btn-outline btn-lg">
            Compare Plans
          </a>
        </div>
        <p class="text-sm text-base-content/50 mt-4">
          No credit card required • 14 days free • Cancel anytime
        </p>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

<script>
  import Cookies from "js-cookie";

  document.addEventListener("DOMContentLoaded", () => {
    initPricingCTAs();
  });

  function initPricingCTAs() {
    const ctaButtons = document.querySelectorAll(".pricing-cta");
    
    ctaButtons.forEach((btn) => {
      btn.addEventListener("click", async (e) => {
        e.preventDefault();
        
        const tier = btn.getAttribute("data-tier") as "maker" | "pro";
        const affiliateCode = Cookies.get("affiliate_code") || localStorage.getItem("affiliate_code");

        // Track pricing CTA click
        if ((window as any).journeyTracker) {
          await (window as any).journeyTracker.trackAction(
            "pricing_cta_click",
            window.location.pathname,
            {
              tier,
              buttonText: (btn as HTMLElement).textContent?.trim() || "",
              timestamp: new Date().toISOString(),
            }
          );
        }

        // Store selected product for checkout flow
        localStorage.setItem(
          "selectedProduct",
          JSON.stringify({
            tier,
            mode: "subscription",
            timestamp: Date.now(),
            affiliateCode: affiliateCode || null,
          })
        );

        // Check if customer is already logged in
        const customerToken = localStorage.getItem("customerToken");
        const customer = JSON.parse(localStorage.getItem("customer") || "{}");

        if (customerToken && customer.id) {
          // Customer is logged in, go to dashboard to manage subscription
          window.location.href = "/customer/dashboard";
        } else {
          // Redirect to registration (not login) with context
          // from=pricing ensures we know they came from pricing page
          window.location.href = `/customer/register?from=pricing&tier=${encodeURIComponent(tier)}&action=trial`;
        }
      });
    });
  }
</script>

<style>
  /* Smooth animations for plan cards */
  .plan-card {
    animation: fadeInUp 0.6s ease-out backwards;
  }
  
  .plan-card:nth-child(1) { animation-delay: 0.1s; }
  .plan-card:nth-child(2) { animation-delay: 0.2s; }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
