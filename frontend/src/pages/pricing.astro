---
import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer.astro";
import BuyButton from "../components/BuyButton.astro";
import DownloadButtons from "../components/DownloadButtons.astro";
import { pricingOffers } from "../data/pricing";
import {
  getSaleTitle,
  getSaleDescription,
  getSaleAlertMessage,
} from "../utils/sale-dates";

const saleTitle = getSaleTitle();
const saleDescription = getSaleDescription();
const saleAlertMessage = getSaleAlertMessage();

const fallbackSite = new URL("https://lightlane.app");
const siteBase = Astro.site ?? fallbackSite;
const toAbsolute = (path: string) => new URL(path, siteBase).href;

const pricingKeywords = [
  "laser engraving software pricing",
  "laser cutter software cost",
  "Lightlane laser engraving license",
  "laser engraving software lifetime license",
  "Ruida laser software pricing",
  "Lightlane pricing plans",
];

const offerSchemas = pricingOffers.map((offer) => {
  const base: Record<string, unknown> = {
    "@type": "Offer",
    priceCurrency: offer.priceCurrency,
    availability: offer.availability,
    url: toAbsolute(offer.ctaPath),
    name: offer.schemaName,
    description: offer.description,
    category: "Software",
  };

  if (offer.sku) base.sku = offer.sku;
  if (typeof offer.price === "number") {
    base.price = offer.price;
  } else {
    base.priceType = "https://schema.org/CallForPrice";
  }

  return base;
});

const fixedOffers = pricingOffers.filter(
  (offer) => typeof offer.price === "number"
);

const aggregateOffer =
  fixedOffers.length > 0
    ? {
        "@type": "AggregateOffer",
        priceCurrency:
          fixedOffers[0]?.priceCurrency ??
          pricingOffers[0]?.priceCurrency ??
          "USD",
        lowPrice: Math.min(...fixedOffers.map((plan) => plan.price as number)),
        highPrice: Math.max(...fixedOffers.map((plan) => plan.price as number)),
        offerCount: fixedOffers.length,
        offers: offerSchemas,
      }
    : undefined;

const pricingFaq = [
  {
    question: "Can I try Lightlane for free before buying?",
    answer:
      "Absolutely. Download Lightlane for macOS or Windows to unlock a 14-day, full-featured trial. No credit card is required and you can test on production hardware before purchasing a lifetime license.",
  },
  {
    question: "Is Lightlane laser engraving software a one-time purchase?",
    answer:
      "Yes. The Hobbyist and Pro plans are lifetime licenses-founders pay once and receive all future Lightlane laser engraving software updates without renewals or subscription fees.",
  },
  {
    question: "Which laser cutters are supported on the paid plans?",
    answer:
      "Lightlane supports Ruida natively and GRBL or G-code laser cutters out of the box. K40 / M2-Nano support and additional controllers are actively being tested and roll out to Pro customers first.",
  },
  {
    question: "Do you offer onboarding for enterprise or education teams?",
    answer:
      "Enterprise and Education tiers include tailored onboarding, governance, and roadmap alignment. Contact the team to scope multi-seat deployments, lab setups, or white-label requirements.",
  },
];

const pricingFaqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "@id": `${toAbsolute("/pricing")}#laser-engraving-pricing-faq`,
  mainEntity: pricingFaq.map((faq) => ({
    "@type": "Question",
    name: faq.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: faq.answer,
    },
  })),
};

const structuredData = [
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "@id": `${toAbsolute("/")}#lightlane-pricing`,
    name: "Lightlane Laser Engraving Software",
    description:
      "Pricing for Lightlane’s laser engraving workflow software with lifetime licensing options.",
    brand: {
      "@type": "Brand",
      name: "Lightlane",
    },
    image: toAbsolute("/NotRoundedLogo.png"),
    offers: aggregateOffer ?? offerSchemas,
    keywords: pricingKeywords.join(", "),
  },
  {
    "@context": "https://schema.org",
    "@type": "OfferCatalog",
    name: "Lightlane Pricing Plans",
    url: toAbsolute("/pricing"),
    itemListElement: offerSchemas.map((offer, index) => ({
      "@type": "ListItem",
      position: index + 1,
      item: {
        ...offer,
      },
    })),
  },
  pricingFaqSchema,
];
---

<Layout
  title="Lightlane Pricing"
  description="Public launch pricing - limited time. Faster import → preview → engrave workflows."
  keywords={pricingKeywords.join(", ")}
  structuredData={structuredData}
  breadcrumbs={[
    { name: "Home", url: "/" },
    { name: "Pricing", url: "/pricing" },
  ]}
>
  <!-- Header rendered by Layout.astro -->

  <main>
    <section class="relative py-24 overflow-hidden">
      <div
        class="absolute inset-0 bg-[radial-gradient(circle_at_30%_40%,rgba(42,158,219,0.15),transparent_60%)]"
      >
      </div>
      <div class="container mx-auto px-4 relative">
        <div class="text-center mb-16 space-y-6 max-w-3xl mx-auto" data-animate>
          <h1 class="text-4xl md:text-5xl font-bold text-ll-gradient pb-1">
            {saleTitle}
          </h1>
          <p
            class="text-lg md:text-xl text-base-content/70"
            set:html={saleDescription}
          />
          <div
            class="flex flex-col md:flex-row gap-4 justify-center items-center"
          >
            <div
              class="badge badge-success badge-soft text-xs py-3 px-4 tracking-wide"
            >
              FOUNDERS LIFETIME • LIMITED AVAILABILITY
            </div>
            <div
              class="badge badge-primary badge-soft text-xs py-3 px-4 tracking-wide"
            >
              GRANDFATHERED LIFETIME UPDATES
            </div>
          </div>
          {
            saleAlertMessage && (
              <div role="alert" class="alert alert-info justify-center">
                <span>{saleAlertMessage}</span>
              </div>
            )
          }
          <div id="pricing-download" class="space-y-3">
            <DownloadButtons align="center" />
            <p class="text-sm text-base-content/70 max-w-2xl mx-auto">
              Download Lightlane for macOS or Windows and unlock every pro
              feature for 14 days - no credit card required.
            </p>
            <div
              class="alert alert-info bg-base-100/80 border border-info/30 justify-between flex-col gap-3 sm:flex-row flex justify-center"
            >
              <span class="font-semibold"
                >Free trial included with every download.</span
              >
              <a
                href="#pricing-download"
                class="btn btn-info btn-sm"
                data-download-modal-trigger>Start Free Trial</a
              >
            </div>
          </div>
          <div class="text-sm">
            <a href="/customer/register" class="link link-primary"
              >Create an account</a
            > to manage your license, sync trials to multiple machines, and checkout
            faster when you’re ready to buy.
          </div>
        </div>

        <div
          id="plans"
          class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"
        >
          <!-- Hobbyist Plan -->
          <div
            class="plan-card group relative p-px rounded-2xl bg-gradient-to-br from-base-300/60 via-base-200 to-base-100 shadow-lg hover:shadow-primary/20 transition"
            data-animate
          >
            <div
              class="relative rounded-[inherit] bg-base-200/80 backdrop-blur-sm p-6 flex flex-col h-full border border-base-300"
            >
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-semibold flex items-center gap-2">
                  Hobbyist
                </h3>
              </div>
              <p class="text-sm text-base-content/70 mb-4 leading-relaxed">
                Solo makers. Fast local iteration with core engraving pipeline.
              </p>
              <div class="mb-6">
                <span class="text-4xl font-bold tracking-tight">$100</span>
                <span class="text-xs text-base-content/50 ml-1">one-time</span>
                <div class="text-[11px] text-success mt-1">
                  Lifetime updates • Grandfathered
                </div>
              </div>
              <ul class="space-y-2 text-sm flex-1">
                <li class="flex gap-2">
                  <span class="text-success">✓</span>GRBL / G-code export &
                  streaming
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Import → preview → engrave
                  pipeline
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Offline activation
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Materials presets (local)
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Community support
                </li>
                <li class="flex gap-2 opacity-75">
                  <span class="text-warning">•</span>Ruida / K40 <span
                    class="badge badge-neutral badge-soft text-[10px] ml-1"
                    >UPGRADE</span
                  >
                </li>
                <li class="flex gap-2 opacity-75">
                  <span class="text-warning">•</span>Remote engraving suite <span
                    class="badge badge-secondary badge-soft text-[10px] ml-1"
                    >PRO+</span
                  >
                </li>
              </ul>
              <BuyButton
                className="mt-6 w-full animate-[fadeIn_.6s_.05s_backwards]"
                variant="primary"
                priceId="price_starter"
                text="Get Hobbyist License"
              />
              <a
                href="#pricing-download"
                class="mt-2 text-[11px] link link-primary text-center block"
                >Try it free before buying</a
              >
            </div>
          </div>

          <!-- Pro Plan -->
          <div
            class="plan-card group relative p-px rounded-2xl bg-gradient-to-br from-primary/40 via-primary/20 to-base-100 shadow-xl ring-1 ring-primary/40 scale-[1.015] hover:scale-[1.03] transition"
            data-animate
          >
            <div
              class="absolute -inset-px rounded-[inherit] bg-gradient-to-br from-primary/60 to-accent/40 opacity-0 group-hover:opacity-100 transition"
            >
            </div>
            <div
              class="relative rounded-[inherit] bg-base-200/90 backdrop-blur-md p-6 flex flex-col h-full border border-primary/40"
            >
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-semibold flex items-center gap-2">
                  Pro <span
                    class="badge badge-secondary badge-soft whitespace-normal text-[10px]"
                    >MOST POPULAR</span
                  >
                </h3>
              </div>
              <p class="text-sm text-base-content/70 mb-4 leading-relaxed">
                Advanced controllers + upcoming team & remote fabrication
                toolkit.
              </p>
              <div class="mb-6">
                <span class="text-4xl font-bold tracking-tight">$200</span>
                <span class="text-xs text-base-content/50 ml-1">one-time</span>
                <div class="text-[11px] text-success mt-1">
                  Lifetime updates • Grandfathered
                </div>
              </div>
              <ul class="space-y-2 text-sm flex-1">
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Everything in Hobbyist
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Ruida controller support
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>K40 / M2-Nano <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >COMING SOON</span
                  >
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Priority support
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Template packs &
                  marketplace access
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Device streaming
                  enhancements
                </li>
                <li class="flex gap-2">
                  <span class="text-accent">•</span>Multi-seat team seats <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >COMING SOON</span
                  >
                </li>
                <li class="flex gap-2">
                  <span class="text-accent">•</span>Remote engraving suite <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >COMING SOON</span
                  >
                </li>
              </ul>
              <BuyButton
                className="mt-6 w-full animate-[fadeIn_.6s_.1s_backwards]"
                variant="primary"
                priceId="price_pro"
                text="Get Pro License"
              />
              <p class="mt-3 text-[11px] text-base-content/50">
                Founders: future extra seats discounted permanently.
              </p>
              <a
                href="#pricing-download"
                class="text-[11px] link link-primary text-center block"
                >Run the pro trial on your machines first</a
              >
            </div>
          </div>

          <!-- Enterprise Plan -->
          <div
            class="plan-card group relative p-px rounded-2xl bg-gradient-to-br from-base-300/70 via-base-200 to-base-100 shadow-lg hover:shadow-accent/20 transition"
            data-animate
          >
            <div
              class="relative rounded-[inherit] bg-base-200/85 backdrop-blur-sm p-6 flex flex-col h-full border border-base-300"
            >
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-semibold">Enterprise</h3>
                <div class="flex gap-2">
                  <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px]"
                    >DISCUSS</span
                  >
                </div>
              </div>
              <p class="text-sm text-base-content/70 mb-4 leading-relaxed">
                Scaling operations & production facilities needing governance &
                customisation.
              </p>
              <div class="mb-6">
                <span class="text-3xl font-semibold tracking-tight">Custom</span
                >
                <div class="text-[11px] text-base-content/50 mt-1">
                  Tailored rollout & roadmap alignment
                </div>
              </div>
              <ul class="space-y-2 text-sm flex-1">
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Everything in Pro
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>White-label build option
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Advanced automation APIs
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Early feature access
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Priority success & advisory
                </li>
                <li class="flex gap-2">
                  <span class="text-accent">•</span>Bulk / multi-site seat
                  management <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >COMING SOON</span
                  >
                </li>
                <li class="flex gap-2">
                  <span class="text-accent">•</span>Remote engraving
                  orchestration <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >COMING SOON</span
                  >
                </li>
              </ul>
              <a
                href="/contact?subject=Enterprise%20Enquiry#contact-form"
                class="mt-6 btn btn-outline w-full animate-[fadeIn_.6s_.15s_backwards]"
                >Talk to Us</a
              >
              <p class="mt-3 text-[11px] text-base-content/50">
                Founders lock discount on all future seat blocks.
              </p>
            </div>
          </div>

          <!-- Education Plan -->
          <div
            class="plan-card group relative p-px rounded-2xl bg-gradient-to-br from-base-300/70 via-base-200 to-base-100 shadow-lg hover:shadow-info/20 transition"
            data-animate
          >
            <div
              class="relative rounded-[inherit] bg-base-200/85 backdrop-blur-sm p-6 flex flex-col h-full border border-base-300"
            >
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-semibold">Education</h3>
                <div class="flex gap-2">
                  <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px]"
                    >DISCUSS</span
                  >
                </div>
              </div>
              <p class="text-sm text-base-content/70 mb-4 leading-relaxed">
                Labs, classrooms & maker programs needing safe, repeatable
                workflows.
              </p>
              <div class="mb-6">
                <span class="text-3xl font-semibold tracking-tight">Custom</span
                >
                <div class="text-[11px] text-base-content/50 mt-1">
                  Institution & program based
                </div>
              </div>
              <ul class="space-y-2 text-sm flex-1">
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Everything in Pro
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Lab / station management <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >PLANNED</span
                  >
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Central material & template
                  sync
                </li>
                <li class="flex gap-2">
                  <span class="text-success">✓</span>Discounted expansion seats
                  (founders)
                </li>
                <li class="flex gap-2">
                  <span class="text-accent">•</span>Classroom remote queue <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >COMING SOON</span
                  >
                </li>
                <li class="flex gap-2">
                  <span class="text-accent">•</span>Curriculum content packs <span
                    class="badge badge-warning badge-soft whitespace-nowrap text-[10px] ml-1"
                    >COMING SOON</span
                  >
                </li>
              </ul>
              <a
                href="/contact?subject=Education%20Access%20Enquiry#contact-form"
                class="mt-6 btn btn-outline w-full animate-[fadeIn_.6s_.2s_backwards]"
                >Discuss Access</a
              >
              <p class="mt-3 text-[11px] text-base-content/50">
                Founders lock permanent base seat allocation.
              </p>
            </div>
          </div>
        </div>

        <div class="mt-16" data-animate>
          <div
            class="alert alert-success bg-base-100/80 border border-success/30 flex flex-col md:flex-row md:items-center gap-4 justify-between"
          >
            <div>
              <h3 class="font-semibold">
                Trial the full build before you buy.
              </h3>
              <p class="text-sm text-base-content/70">
                Install Lightlane on your production workstation, sync projects,
                and run actual jobs during the 14-day pro trial.
              </p>
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
              <a
                href="#pricing-download"
                class="btn btn-success"
                data-download-modal-trigger>Start Free Trial</a
              >
              <a href="/pricing#plans" class="btn btn-outline">Compare Plans</a>
            </div>
          </div>
        </div>

        <div
          class="mt-20 max-w-4xl mx-auto grid md:grid-cols-2 gap-10 items-start"
          data-animate
        >
          <div class="space-y-4">
            <h2 class="text-2xl font-semibold text-ll-gradient">
              Why lock pricing now?
            </h2>
            <ul class="text-sm space-y-2 text-base-content/70">
              <li class="flex gap-2">
                <span class="text-accent">•</span>One-time founding purchase →
                lifetime updates & features.
              </li>
              <li class="flex gap-2">
                <span class="text-accent">•</span>Seat baseline guaranteed:
                first seat can’t be clawed back.
              </li>
              <li class="flex gap-2">
                <span class="text-accent">•</span>Permanent discounted rate on
                future additional seats.
              </li>
              <li class="flex gap-2">
                <span class="text-accent">•</span>Priority feedback channel
                influences roadmap.
              </li>
              <li class="flex gap-2">
                <span class="text-accent">•</span>Earlier access to controller &
                remote tooling betas.
              </li>
            </ul>
          </div>
          <div
            class="p-6 rounded-xl bg-base-200/60 border border-base-300 space-y-4 relative overflow-hidden"
          >
            <div
              class="pointer-events-none absolute -top-10 -right-10 w-40 h-40 bg-[radial-gradient(circle_at_center,rgba(42,158,219,0.35),transparent_70%)]"
            >
            </div>
            <h3 class="font-semibold text-base">Coming Soon Highlights</h3>
            <ul class="text-sm text-base-content/70 space-y-2">
              <li class="flex gap-2">
                <span class="text-warning">→</span>Remote engraving & job
                orchestration (Pro+)
              </li>
              <li class="flex gap-2">
                <span class="text-warning">→</span>Multi-seat/team license
                management
              </li>
              <li class="flex gap-2">
                <span class="text-warning">→</span>Bulk device profile
                deployment
              </li>
              <li class="flex gap-2">
                <span class="text-warning">→</span>K40 / M2-Nano controller path
              </li>
              <li class="flex gap-2">
                <span class="text-warning">→</span>White-label enterprise builds
              </li>
            </ul>
            <p class="text-[11px] text-base-content/50">
              All roadmap items above included for existing founders without
              extra upgrade fees.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section class="section bg-base-200/40">
      <div class="container max-w-5xl" data-animate>
        <div class="page-header text-center">
          <h2 class="text-3xl md:text-4xl font-bold text-ll-gradient">
            Laser engraving software pricing FAQ
          </h2>
          <p class="mt-4 text-base-content/70 max-w-2xl mx-auto">
            Answers to common questions about Lightlane laser cutter software
            licenses, supported controllers, and enterprise onboarding.
          </p>
        </div>
        <div class="mt-10 space-y-4">
          {
            pricingFaq.map((faq) => (
              <details class="group rounded-xl border border-base-300 bg-base-100/90 p-6 shadow-sm">
                <summary class="cursor-pointer text-lg font-semibold text-base-content transition group-open:text-primary">
                  {faq.question}
                </summary>
                <p class="mt-3 text-sm text-base-content/70 leading-relaxed">
                  {faq.answer}
                </p>
              </details>
            ))
          }
        </div>
      </div>
    </section>
  </main>
  <Footer />
</Layout>
