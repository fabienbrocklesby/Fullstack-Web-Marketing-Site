---
interface Props {
  size?: "xs" | "sm" | "md" | "lg" | "xl";
  soft?: boolean; // use btn-soft instead of solid
  showChecksums?: boolean;
  align?: "left" | "center" | "right";
  class?: string;
}
const {
  size = "sm",
  soft = true,
  showChecksums = true,
  align = "left",
  class: klass = "",
} = Astro.props as Props;

const DOWNLOAD_BASE_URL = "https://downloads.lightlane.app";
// Default to the rolling "latest" folder in R2 unless an explicit version is provided via env
const fallbackVersion = "latest";

// @ts-ignore - Astro injects env at build time
const betaEnvRaw = import.meta.env.PUBLIC_USE_BETA_DOWNLOADS;
// Handle various truthy values: "true", true, "1", etc.
// TEMP: Hardcoded to true until Dokploy build args are fixed
const useBeta = true;

// @ts-ignore - Astro injects env at build time
const rawVersion = import.meta.env.PUBLIC_DOWNLOAD_VERSION || fallbackVersion;
const normalizedVersion = rawVersion.trim().replace(/^\/+|\/+$/g, "");
const resolvedVersion =
  normalizedVersion.length > 0 ? normalizedVersion : fallbackVersion;

// If beta flag is set, prepend "beta/" to the path
const versionPath = useBeta ? `beta/${resolvedVersion}` : resolvedVersion;
const baseUrl = `${DOWNLOAD_BASE_URL.replace(/\/$/, "")}/${versionPath}`;
const macArmHref = `${baseUrl}/Light-Lane-macOS-arm64.dmg`;
const macIntelHref = `${baseUrl}/Light-Lane-macOS-amd64.dmg`;
const windowsHref = `${baseUrl}/Light-Lane-Windows-amd64.exe`;
const checksumsHref = `${baseUrl}/SHA256SUMS.txt`;
---

<div
  class={`flex flex-wrap gap-2 ${align === "center" ? "justify-center" : align === "right" ? "justify-end" : ""} ${klass}`}
>
  <a
    id="dl-mac-arm"
    class={`btn ${soft ? "btn-soft" : "btn-primary"} btn-${size}`}
    href={macArmHref}>Download macOS (AppleÂ Silicon)</a
  >
  <a
    id="dl-mac-intel"
    class={`btn ${soft ? "btn-soft" : "btn-primary"} btn-${size}`}
    href={macIntelHref}>Download macOS (Intel)</a
  >
  <a
    id="dl-win"
    class={`btn ${soft ? "btn-soft" : "btn-primary"} btn-${size}`}
    href={windowsHref}>Download Windows</a
  >
  {
    showChecksums && (
      <a id="dl-sums" class={`btn btn-ghost btn-${size}`} href={checksumsHref}>
        Checksums
      </a>
    )
  }
</div>
