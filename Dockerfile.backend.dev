FROM node:22-alpine

# Install build tools required for native dependencies
RUN apk add --no-cache python3 make g++ bash git

# Enable pnpm via corepack
RUN corepack enable && corepack prepare pnpm@latest --activate

# Set environment for pnpm
ENV PNPM_HOME=/root/.local/share/pnpm
ENV PATH=$PNPM_HOME:$PATH

WORKDIR /workspace

# Copy entrypoint script
COPY docker/dev/entrypoint.backend.sh /usr/local/bin/start-backend.sh
RUN chmod +x /usr/local/bin/start-backend.sh

EXPOSE 1337
CMD ["/usr/local/bin/start-backend.sh"]
